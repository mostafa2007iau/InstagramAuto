<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="InstagramAuto.Client.Views.HealthPage"
             Title="????? ????? / System Health">
    <ScrollView>
        <StackLayout Padding="16" Spacing="14">
            <Label Text="????? ????? ?????" FontSize="22" HorizontalOptions="Center" />

            <!-- Overall Status -->
            <Frame BorderColor="{Binding StatusColor}" Padding="12">
                <StackLayout>
                    <Label Text="????? ???" FontSize="18" FontAttributes="Bold" />
                    <Label Text="{Binding HealthStatus.Message}" />
                    <Label Text="{Binding HealthStatus.LastCheckTime, StringFormat='????? ?????: {0:yyyy/MM/dd HH:mm:ss}'}" />
                </StackLayout>
            </Frame>

            <!-- Services Status -->
            <Label Text="????? ????????" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <CollectionView ItemsSource="{Binding Services}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="0,0,0,8" BorderColor="{Binding StatusColor}">
                            <Grid ColumnDefinitions="2*,*,*">
                                <StackLayout Grid.Column="0">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" />
                                    <Label Text="{Binding Message}" FontSize="12" />
                                </StackLayout>
                                <Label Text="{Binding Status}" Grid.Column="1" 
                                       VerticalOptions="Center" />
                                <Label Text="{Binding LastResponseTime, StringFormat='{0:F0}ms'}" 
                                       Grid.Column="2" VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Metrics -->
            <Label Text="????????? ?????" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0" />
            <CollectionView ItemsSource="{Binding Metrics}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="8" ColumnDefinitions="2*,*">
                            <Label Text="{Binding Key}" Grid.Column="0" />
                            <Label Text="{Binding Value, StringFormat='{0:F2}'}" Grid.Column="1" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Refresh Button -->
            <Button Text="?????????" 
                    Command="{Binding RefreshCommand}"
                    IsEnabled="{Binding IsNotBusy}"
                    Margin="0,20,0,0" />

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                             IsVisible="{Binding IsBusy}"
                             HorizontalOptions="Center" />
        </StackLayout>
    </ScrollView>
</ContentPage>